<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TH-BLE Component Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-card h3 {
            color: #ffd700;
            margin-bottom: 15px;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 5px;
            font-size: 14px;
        }
        
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.warning { background: #ff9800; color: white; }
        .status.info { background: #2196F3; color: white; }
        
        .sensor-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        
        .sensor-value {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .sensor-label {
            color: #ccc;
            font-size: 0.9em;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
        }
        
        .button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .logs {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 5px;
        }
        
        .log-info { background: rgba(33, 150, 243, 0.2); }
        .log-success { background: rgba(76, 175, 80, 0.2); }
        .log-warning { background: rgba(255, 152, 0, 0.2); }
        .log-error { background: rgba(244, 67, 54, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß TH-BLE Component Test Suite</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–∞—Ç—á–∏–∫–æ–≤</p>
        </div>

        <div class="test-grid">
            <!-- –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
            <div class="test-card">
                <h3>üîµ Bluetooth Connection</h3>
                <div id="bluetooth-status">
                    <span class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
                <button class="button" onclick="testBluetooth()">–¢–µ—Å—Ç Bluetooth</button>
                <div id="bluetooth-details" style="margin-top: 10px; font-size: 12px;"></div>
            </div>

            <!-- –¢–µ—Å—Ç –¥–∞—Ç—á–∏–∫–∞ -->
            <div class="test-card">
                <h3>üå°Ô∏è Sensor Data</h3>
                <div class="sensor-card">
                    <div class="sensor-value" id="temperature">--¬∞C</div>
                    <div class="sensor-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
                </div>
                <div class="sensor-card">
                    <div class="sensor-value" id="humidity">--%</div>
                    <div class="sensor-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å</div>
                </div>
                <button class="button" onclick="simulateSensorData()">–°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</button>
            </div>

            <!-- –¢–µ—Å—Ç –≥—Ä–∞—Ñ–∏–∫–∞ -->
            <div class="test-card">
                <h3>üìà Data Chart</h3>
                <div class="chart-container" id="chart-container">
                    <div>–ì—Ä–∞—Ñ–∏–∫ –¥–∞–Ω–Ω—ã—Ö</div>
                </div>
                <button class="button" onclick="generateChart()">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫</button>
            </div>

            <!-- –¢–µ—Å—Ç WebSocket -->
            <div class="test-card">
                <h3>üåê WebSocket</h3>
                <div id="websocket-status">
                    <span class="status info">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</span>
                </div>
                <button class="button" onclick="testWebSocket()">–¢–µ—Å—Ç WebSocket</button>
                <div id="websocket-details" style="margin-top: 10px; font-size: 12px;"></div>
            </div>

            <!-- –¢–µ—Å—Ç Telegram -->
            <div class="test-card">
                <h3>üì± Telegram WebApp</h3>
                <div id="telegram-status">
                    <span class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                </div>
                <button class="button" onclick="testTelegram()">–¢–µ—Å—Ç Telegram</button>
                <div id="telegram-details" style="margin-top: 10px; font-size: 12px;"></div>
            </div>

            <!-- –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
            <div class="test-card">
                <h3>‚ö° Performance</h3>
                <div id="performance-status">
                    <span class="status info">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...</span>
                </div>
                <button class="button" onclick="testPerformance()">–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</button>
                <div id="performance-details" style="margin-top: 10px; font-size: 12px;"></div>
            </div>
        </div>

        <!-- –õ–æ–≥–∏ -->
        <div class="test-card">
            <h3>üìù Test Logs</h3>
            <div class="logs" id="test-logs">
                <div class="log-entry log-info">[INFO] –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞</div>
            </div>
            <button class="button" onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let sensorData = [];
        let chartData = [];
        let ws = null;

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const logs = document.getElementById('test-logs');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            document.getElementById('test-logs').innerHTML = '';
            log('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        // –¢–µ—Å—Ç Bluetooth
        function testBluetooth() {
            const status = document.getElementById('bluetooth-status');
            const details = document.getElementById('bluetooth-details');
            
            status.innerHTML = '<span class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>';
            log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç Bluetooth API', 'info');
            
            if ('bluetooth' in navigator) {
                status.innerHTML = '<span class="status success">‚úÖ Bluetooth API –¥–æ—Å—Ç—É–ø–µ–Ω</span>';
                details.innerHTML = 'Web Bluetooth API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º';
                log('Bluetooth API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'success');
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                if (navigator.bluetooth.getAvailability) {
                    navigator.bluetooth.getAvailability().then(available => {
                        if (available) {
                            details.innerHTML += '<br>‚úÖ Bluetooth –∞–¥–∞–ø—Ç–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω';
                            log('Bluetooth –∞–¥–∞–ø—Ç–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω', 'success');
                        } else {
                            details.innerHTML += '<br>‚ö†Ô∏è Bluetooth –∞–¥–∞–ø—Ç–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω';
                            log('Bluetooth –∞–¥–∞–ø—Ç–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω', 'warning');
                        }
                    });
                }
            } else {
                status.innerHTML = '<span class="status error">‚ùå Bluetooth API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>';
                details.innerHTML = 'Web Bluetooth API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ';
                log('Bluetooth API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
            }
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–∞—Ç—á–∏–∫–∞
        function simulateSensorData() {
            const temperature = (Math.random() * 30 + 10).toFixed(1);
            const humidity = (Math.random() * 40 + 30).toFixed(1);
            
            document.getElementById('temperature').textContent = temperature + '¬∞C';
            document.getElementById('humidity').textContent = humidity + '%';
            
            sensorData.push({
                timestamp: new Date(),
                temperature: parseFloat(temperature),
                humidity: parseFloat(humidity)
            });
            
            log(`–°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: ${temperature}¬∞C, ${humidity}%`, 'info');
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
        function generateChart() {
            const container = document.getElementById('chart-container');
            
            if (sensorData.length === 0) {
                container.innerHTML = '<div>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>';
                return;
            }
            
            // –ü—Ä–æ—Å—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
            const tempData = sensorData.map(d => d.temperature);
            const humData = sensorData.map(d => d.humidity);
            
            const maxTemp = Math.max(...tempData);
            const minTemp = Math.min(...tempData);
            const avgTemp = (tempData.reduce((a, b) => a + b, 0) / tempData.length).toFixed(1);
            
            container.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.5em; margin-bottom: 10px;">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö</div>
                    <div style="margin: 5px 0;">üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${minTemp}¬∞C - ${maxTemp}¬∞C</div>
                    <div style="margin: 5px 0;">üìà –°—Ä–µ–¥–Ω—è—è: ${avgTemp}¬∞C</div>
                    <div style="margin: 5px 0;">üìä –ó–∞–ø–∏—Å–µ–π: ${sensorData.length}</div>
                </div>
            `;
            
            log(`–ì—Ä–∞—Ñ–∏–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è ${sensorData.length} –∑–∞–ø–∏—Å–µ–π`, 'success');
        }

        // –¢–µ—Å—Ç WebSocket
        function testWebSocket() {
            const status = document.getElementById('websocket-status');
            const details = document.getElementById('websocket-details');
            
            status.innerHTML = '<span class="status info">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>';
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'info');
            
            try {
                ws = new WebSocket('ws://localhost:3000');
                
                ws.onopen = function() {
                    status.innerHTML = '<span class="status success">‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω</span>';
                    details.innerHTML = '–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
                    log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                };
                
                ws.onmessage = function(event) {
                    log(`WebSocket —Å–æ–æ–±—â–µ–Ω–∏–µ: ${event.data}`, 'info');
                };
                
                ws.onerror = function(error) {
                    status.innerHTML = '<span class="status warning">‚ö†Ô∏è WebSocket –æ—à–∏–±–∫–∞</span>';
                    details.innerHTML = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è dev —Ä–µ–∂–∏–º–∞)';
                    log('WebSocket –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'warning');
                };
                
                ws.onclose = function() {
                    status.innerHTML = '<span class="status info">WebSocket –æ—Ç–∫–ª—é—á–µ–Ω</span>';
                    log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ', 'info');
                };
                
            } catch (e) {
                status.innerHTML = '<span class="status error">‚ùå WebSocket –æ—à–∏–±–∫–∞</span>';
                details.innerHTML = '–û—à–∏–±–∫–∞: ' + e.message;
                log('WebSocket –æ—à–∏–±–∫–∞: ' + e.message, 'error');
            }
        }

        // –¢–µ—Å—Ç Telegram
        function testTelegram() {
            const status = document.getElementById('telegram-status');
            const details = document.getElementById('telegram-details');
            
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram WebApp API', 'info');
            
            if (window.Telegram && window.Telegram.WebApp) {
                status.innerHTML = '<span class="status success">‚úÖ Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω</span>';
                details.innerHTML = `
                    –í–µ—Ä—Å–∏—è: ${window.Telegram.WebApp.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}<br>
                    –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${window.Telegram.WebApp.platform || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}<br>
                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${window.Telegram.WebApp.initDataUnsafe?.user?.first_name || '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}
                `;
                log('Telegram WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
            } else {
                status.innerHTML = '<span class="status warning">‚ö†Ô∏è Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</span>';
                details.innerHTML = '–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏';
                log('Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ Telegram)', 'warning');
            }
        }

        // –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        function testPerformance() {
            const status = document.getElementById('performance-status');
            const details = document.getElementById('performance-details');
            
            status.innerHTML = '<span class="status info">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...</span>';
            log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', 'info');
            
            const startTime = performance.now();
            
            // –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
            const testData = Array.from({length: 1000}, (_, i) => ({
                timestamp: new Date(Date.now() - i * 1000),
                temperature: Math.random() * 30 + 10,
                humidity: Math.random() * 40 + 30
            }));
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            const processed = testData.map(d => ({
                ...d,
                tempF: d.temperature * 9/5 + 32,
                humCategory: d.humidity > 60 ? '–≤—ã—Å–æ–∫–∞—è' : d.humidity < 30 ? '–Ω–∏–∑–∫–∞—è' : '–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è'
            }));
            
            const endTime = performance.now();
            const duration = (endTime - startTime).toFixed(2);
            
            status.innerHTML = '<span class="status success">‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω</span>';
            details.innerHTML = `
                –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${processed.length} –∑–∞–ø–∏—Å–µ–π<br>
                –í—Ä–µ–º—è: ${duration}–º—Å<br>
                –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${(processed.length / duration * 1000).toFixed(0)} –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫
            `;
            
            log(`–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω: ${duration}–º—Å`, 'success');
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            log('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –æ—Å–Ω–æ–≤–Ω—ã—Ö API
            setTimeout(() => {
                testBluetooth();
                testTelegram();
                testPerformance();
            }, 1000);
        });
    </script>
</body>
</html>